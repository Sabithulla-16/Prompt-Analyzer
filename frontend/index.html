<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Prompt Analyzer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  font-family: system-ui, sans-serif;
  background:#f7f7f8;
  margin:0;
}

.container {
  max-width:820px;
  margin:40px auto;
  padding:20px;
}

h1 { text-align:center; }
.subtitle { text-align:center; color:#555; margin-bottom:20px; }

.top-bar {
  display:flex;
  justify-content:flex-end;
  margin-bottom:10px;
}

textarea {
  width:100%;
  min-height:70px;
  padding:12px;
  font-size:16px;
  border-radius:8px;
  border:1px solid #ccc;
}

.input-box { display:flex; gap:10px; }

button {
  padding:0 20px;
  border:none;
  border-radius:8px;
  background:#000;
  color:#fff;
  cursor:pointer;
}

button.secondary { background:#444; }
button.icon {
  background:#eee;
  color:#000;
  font-size:18px;
}

.status {
  margin-top:12px;
  font-style:italic;
  color:#555;
}

.suggestions span {
  display:inline-block;
  background:#eaeaea;
  padding:8px 12px;
  margin:6px;
  border-radius:20px;
  cursor:pointer;
}

.results { margin-top:25px; }

.tool-card {
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
  cursor:pointer;
}

/* TOOL MODAL */
#toolModal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.45);
  z-index:1000;
}

#toolModalContent {
  background:#fff;
  max-width:520px;
  margin:8% auto;
  padding:20px;
  border-radius:12px;
  position:relative;
}

.close-btn {
  position:absolute;
  top:10px;
  right:14px;
  cursor:pointer;
  font-size:18px;
}

/* CHATBOT */
#chatbot {
  display:none;
  position:fixed;
  bottom:20px;
  right:20px;
  width:360px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.25);
  z-index:1100;
}

#chatHeader {
  padding:10px;
  font-weight:600;
  display:flex;
  justify-content:space-between;
  border-bottom:1px solid #ddd;
}

#chatBody { padding:10px; }

#chatMessages {
  height:220px;
  overflow-y:auto;
  font-size:14px;
}

.chat-msg { margin-bottom:10px; }

.chat-ai {
  background:#f4f4f5;
  padding:10px;
  border-radius:8px;
  white-space:pre-wrap;
}

#typingIndicator {
  font-size:12px;
  color:#666;
  display:none;
  margin-top:5px;
}

#chatFooter {
  display:flex;
  gap:6px;
  margin-top:10px;
}

#chatInput {
  flex:1;
  padding:8px;
}

.copy-btn {
  float:right;
  font-size:12px;
  background:#444;
  padding:4px 8px;
  border-radius:4px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

<div class="top-bar">
  <button class="secondary" onclick="toggleChat()">üí¨ Ask AI</button>
</div>

<h1>AI Prompt Analyzer</h1>
<div class="subtitle">Type anything ‚Äî even a bad or vague prompt ‚Äî we‚Äôll figure it out.</div>

<div class="input-box">
  <textarea id="prompt" placeholder="Type your prompt here..."></textarea>
  <button class="icon" id="micBtn" onclick="toggleMic()">üéôÔ∏è</button>
  <button id="analyzeBtn" onclick="analyzePrompt()">Analyze</button>
</div>

<div id="status" class="status"></div>
<div id="suggestions" class="suggestions"></div>
<div id="results" class="results"></div>

</div>

<!-- TOOL MODAL -->
<div id="toolModal">
  <div id="toolModalContent">
    <span class="close-btn" onclick="closeToolModal()">‚úï</span>
    <h2 id="toolName"></h2>
    <p id="toolDescription"></p>
    <p><b>Domain:</b> <span id="toolDomain"></span></p>
    <p><b>Actions:</b> <span id="toolActions"></span></p>
    <p><b>Use cases:</b> <span id="toolUseCases"></span></p>
    <p><b>Pricing:</b> <span id="toolPricing"></span></p>
    <a id="toolLink" target="_blank"><button>Visit Tool</button></a>
  </div>
</div>

<!-- CHATBOT -->
<div id="chatbot">
  <div id="chatHeader">
    <span>AI Assistant</span>
    <span style="cursor:pointer" onclick="toggleChat()">‚úï</span>
  </div>

  <div id="chatBody">
    <div id="chatMessages"></div>
    <div id="typingIndicator">AI is typing‚Ä¶</div>

    <div id="chatFooter">
      <input id="chatInput" placeholder="Ask anything..." />
      <button onclick="sendChat()">Send</button>
    </div>
  </div>
</div>

<script>
const API_URL = "http://127.0.0.1:8000/recommend";
const CHAT_URL = "http://127.0.0.1:8000/chat";

let recognition = null;
let recording = false;
let controller = null;

/* MIC TOGGLE */
function toggleMic() {
  if (!('webkitSpeechRecognition' in window)) {
    alert("Voice input not supported");
    return;
  }

  if (!recording) {
    recognition = new webkitSpeechRecognition();
    recognition.lang = "en-US";
    recognition.onresult = e => {
      document.getElementById("prompt").value =
        e.results[0][0].transcript;
    };
    recognition.start();
    recording = true;
    micBtn.innerText = "‚õî";
  } else {
    recognition.stop();
    recording = false;
    micBtn.innerText = "üéôÔ∏è";
  }
}

/* ANALYZE / STOP */
async function analyzePrompt() {
  const btn = document.getElementById("analyzeBtn");
  const prompt = document.getElementById("prompt").value.trim();
  const results = document.getElementById("results");
  const status = document.getElementById("status");

  /* STOP */
  if (controller) {
    controller.abort();
    controller = null;
    btn.innerText = "Analyze";
    status.innerText = "‚õî Analysis stopped";
    return;
  }

  if (!prompt) { showSuggestions(); return; }

  controller = new AbortController();
  btn.innerText = "Stop";
  results.innerHTML = "";
  status.innerText = "ü§î Analyzing‚Ä¶";

  const start = performance.now();

  try {
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ prompt }),
      signal: controller.signal
    });

    const data = await res.json();
    const secs = ((performance.now() - start)/1000).toFixed(2);
    status.innerText = `‚úÖ Analyzed in ${secs}s`;
    btn.innerText = "Analyze";
    controller = null;

    results.innerHTML = `
      <b>Rewritten:</b> ${data.rewritten_prompt}<br/>
      <b>Confidence:</b> ${data.confidence}%<br/><br/>
    `;

    data.tools.forEach(tool => {
      const card = document.createElement("div");
      card.className = "tool-card";
      card.onclick = () => openToolModal(tool);
      card.innerHTML = `
        <h3>${tool.name}</h3>
        <div>${tool.description}</div>
        <div><b>Score:</b> ${tool.score}</div>
      `;
      results.appendChild(card);
    });
  } catch (e) {
    status.innerText = "‚õî Analysis stopped";
    btn.innerText = "Analyze";
    controller = null;
  }
}

/* SUGGESTIONS */
const defaultSuggestions = [
  "Convert my voice recording into text",
  "Create a professional logo for my startup",
  "Write Python code",
  "Make Instagram reels automatically",
  "Summarize a research paper"
];

function showSuggestions() {
  const box = document.getElementById("suggestions");
  box.innerHTML = "<b>Try one of these:</b><br/>";
  defaultSuggestions.forEach(t => {
    const s = document.createElement("span");
    s.innerText = t;
    s.onclick = () => {
      document.getElementById("prompt").value = t;
      analyzePrompt();
    };
    box.appendChild(s);
  });
}

/* TOOL MODAL */
function openToolModal(tool) {
  toolName.innerText = tool.name;
  toolDescription.innerText = tool.description;
  toolDomain.innerText = tool.domain;
  toolActions.innerText = (tool.actions || []).join(", ");
  toolUseCases.innerText = tool.use_cases.join(", ");
  toolPricing.innerText = tool.pricing;
  toolLink.href = tool.website || "#";
  toolModal.style.display = "block";
}
function closeToolModal() { toolModal.style.display = "none"; }

/* CHAT */
function toggleChat() {
  chatbot.style.display =
    chatbot.style.display === "block" ? "none" : "block";
}
async function sendChat() {
  const input = chatInput;
  const msg = input.value.trim();
  if (!msg) return;
  chatMessages.innerHTML += `<div class="chat-msg"><b>You:</b> ${msg}</div>`;
  input.value = "";
  typingIndicator.style.display = "block";

  const res = await fetch(CHAT_URL, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ message: msg })
  });

  const data = await res.json();
  typingIndicator.style.display = "none";
  chatMessages.innerHTML += `
    <div class="chat-msg chat-ai">
      <button class="copy-btn"
        onclick="navigator.clipboard.writeText(this.nextSibling.innerText)">
        Copy
      </button>
      <span>${data.reply}</span>
    </div>
  `;
}

showSuggestions();
const promptBox = document.getElementById("prompt");
promptBox.addEventListener("input", () => {
  document.getElementById("results").innerHTML = "";
  document.getElementById("status").innerText = "";
});
</script>
</body>
</html>